<html>

<head>
<title>ESPNode Settings</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
</head>

<body style="cursor: wait;">
<nav class="navbar navbar-fixed-top navbar-inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <a class="navbar-brand" href="#">ESPNode Settings</a>
    </div>
  </div><!-- /.container-fluid -->
</nav>

<div class="container" style="padding-top: 80px;">

  <!-- Network settings section -->
  <div class="panel panel-default">
    <div class="panel-heading"><h2 class="panel-title">Network</h2></div>
    <div class="panel-body">
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label class="col-sm-3" for="ssid">SSID</label>
            <div class="col-sm-8">
              <input type="text" class="form-control" placeholder="Enter WiFi SSID" id="ssid" name="ssid" maxlength="31">
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3" for="password">Password</label>
            <div class="col-sm-8">
              <input type="password" class="form-control" placeholder="Enter WiFi password" id="password" name="password" maxlength="63">
            </div>
          </div>
        </div> <!-- col -->
        <div class="col-md-6">
          <div class="form-group">
            <label class="col-sm-3" for="hostname">Hostname</label>
            <div class="col-sm-8">
              <input type="text" class="form-control" placeholder="Enter hostname" id="hostname" name="hostname" maxlength="31">
            </div>
          </div>
        </div> <!-- col -->
      </div> <!-- row -->
    </div> <!-- panel-body -->
  </div> <!-- panel -->

  <!-- Location/time section -->
  <div class="panel panel-default">
    <div class="panel-heading"><h2 class="panel-title">Location &amp; time</h2></div>
    <div class="panel-body">
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label class="col-sm-3" for="tz">Timezone</label>
            <div class="col-sm-8">
              <select class="form-control" id="utcoffset" name="utcoffset">
              	<option		value="-12">(GMT-12:00)	International	Date	Line	West</option>						
              	<option		value="-11">(GMT-11:00)	Midway	Island,	Samoa</option>							
              	<option		value="-10">(GMT-10:00)	Hawaii</option>									
              	<option		value="-9">(GMT-09:00)	Alaska</option>									
              	<option		value="-8">(GMT-08:00)	Pacific	Time	(US	&	Canada)</option>					
              	<option		value="-7">(GMT-07:00)	Mountain	Time	(US	&	Canada)</option>					
              	<option		value="-6">(GMT-06:00)	Central	Time	(US	&	Canada)</option>					
              	<option		value="-5">(GMT-05:00)	Eastern	Time	(US	&	Canada)</option>					
              	<option		value="-4">(GMT-04:00)	Atlantic	Time	(Canada)</option>							
              	<option		value="-3">(GMT-03:00)	Buenos	Aires,	Georgetown</option>							
              	<option		value="-2">(GMT-02:00)	Mid-Atlantic</option>									
              	<option		value="-1">(GMT-01:00)	Azores</option>									
              	<option		value="0">(GMT+00:00)	Greenwich	Mean	Time	:	Dublin,	Edinburgh,	Lisbon,	London</option>		
              	<option		selected="selected" value="1">(GMT+01:00)	Brussels,	Copenhagen,	Madrid,	Paris</option>						
              	<option		value="2">(GMT+02:00)	Athens,	Bucharest,	Istanbul</option>							
              	<option		value="3">(GMT+03:00)	Moscow,	St.	Petersburg,	Volgograd</option>						
              	<option		value="4">(GMT+04:00)	Abu	Dhabi,	Muscat</option>							
              	<option		value="5">(GMT+05:00)	Islamabad,	Karachi,	Tashkent</option>							
              	<option		value="6">(GMT+06:00)	Astana,	Dhaka</option>								
              	<option		value="7">(GMT+07:00)	Bangkok,	Hanoi,	Jakarta</option>							
              	<option		value="8">(GMT+08:00)	Beijing,	Chongqing,	Hong	Kong,	Urumqi</option>					
              	<option		value="9">(GMT+09:00)	Seoul</option>									
              	<option		value="10">(GMT+10:00)	Canberra,	Melbourne,	Sydney</option>							
              	<option		value="11">(GMT+11:00)	Magadan,	Solomon	Is.,	New	Caledonia</option>					
              	<option		value="12">(GMT+12:00)	Auckland,	Wellington</option>								
	            </select>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3">Time</label>
            <div class="col-sm-8">
              <a id="curtime"></a>
            </div>
          </div>
        </div> <!-- col -->
        <div class="col-md-6">
          <div class="form-group">
            <label class="col-sm-3" for="ntp">NTP serveur</label>
            <div class="col-sm-8">
              <input type="text" class="form-control" placeholder="Enter NTP server" id="ntpserver" name="ntpserver" maxlength="31">
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3" for="ntp">Daylight saving</label>
            <div class="col-sm-8">
              <input type="checkbox" class="form-control" id="daylight" name="daylight">
            </div>
          </div>
        </div> <!-- col -->
      </div> <!-- row -->
    </div> <!-- panel-body -->
  </div> <!-- panel -->
  <div class="col-md-6">
    <button class="btn btn-default btn-large btn-primary" onClick="save()">Save</button>
    <button class="btn btn-default btn-large btn-primary" onClick="load()">Refresh</button>
  </div> <!-- col-md-6 -->
</div> <!-- container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

<script>
/*
$(function(){  
  $("html").bind("ajaxStart", function(){  
     $(this).addClass('busy');  
   }).bind("ajaxStop", function(){  
     $(this).removeClass('busy');  
   });  
});
*/
function load() {
  $.getJSON("/api/settings", function(data) {
    $("#ssid").val(data.ssid);
    $("#password").val(data.password);
    $("#hostname").val(data.hostname);
    $("#utcoffset").val(data.utcoffset);
    $("#ntpserver").val(data.ntpserver);
    $("#curtime").text(data.curtime);
    $("#daylight").prop( "checked", data.daylight == 0 ? false : true);
    $(document.body).css({ 'cursor': 'default' });
  });
}

window.onload = load(); 

function save() {
  $(document.body).css({ 'cursor': 'wait' });
  var data  = JSON.stringify({
    ssid: $("#ssid").val(),
    password: $("#password").val(),
    hostname: $("#hostname").val(),
    utcoffset : parseInt($("#utcoffset").val(), 10),
    ntpserver: $("#ntpserver").val(),
    daylight: $('#daylight').prop('checked') == true ? 1 : 0
  });
  $.ajax("/api/update", {
    type: "post",
    contentType: "application/json",
    data: data,
    success: function(result) { 
      if (result.showMessage == true) {
        $(document.body).css({ 'cursor': 'default' });
        alert("Settings saved.\nPower-cycle to take effect."); 
        $(document.body).css({ 'cursor': 'wait' });
      } 
      /* location.reload();  */
      load();
    },
    error: function (request, status, error) { alert("Error saving settings:\n" + request.responseText); }
  });
/*  event.preventDefault(); */
}
</script>

</body>

</html>
